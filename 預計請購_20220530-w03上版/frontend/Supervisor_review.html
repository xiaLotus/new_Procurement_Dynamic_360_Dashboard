<!DOCTYPE html>
<html lang="zh-TW" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>長官審核頁面</title>
    
    <!-- Vue 3 -->
    <script src="../static/js/vue.global.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="../static/js/sweetalert2@11.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="../static/js/tailwinds.js"></script>
    
    <!-- Lucide Icons -->
    <script src="../static/js/lucide.js"></script>
    
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        [v-cloak] {
            display: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-approved {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-rejected {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .table-wrapper {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        
        .table-container {
            flex: 1;
            overflow: auto;
        }
        
        .sticky-header th {
            position: sticky;
            top: 0;
            background-color: #1e40af;
            color: white;
            z-index: 10;
            white-space: nowrap;
        }
        
        .row-selected {
            background-color: #dbeafe !important;
        }
        
        .hover-row:hover {
            background-color: #f3f4f6;
        }
        
        /* 允許內容完整顯示 */
        .full-content {
            min-width: 120px;
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.4;
        }
        
        /* 不換行欄位 */
        .nowrap-cell {
            white-space: nowrap;
        }
        
        .bg-green-50 {
            background-color: #f0fdf4;
        }
        
        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .break-words {
            word-wrap: break-word;
            word-break: break-word;
            line-height: 1.5;
        }
        
        .remark-display {
            font-size: 12px;
            line-height: 1.5;
            max-height: 80px;
            overflow-y: auto;
            padding: 4px;
        }
    
        table {
            table-layout: auto;
        }
        
        td, th {
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .mini-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* 下拉篩選動畫 */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.2s;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* 篩選高亮 */
        .filter-active {
            background-color: #fbbf24 !important;
            color: #dc2626 !important;
        }
        
        /* 下拉篩選卡片 */
        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 8px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 50;
            min-width: 200px;
            padding: 8px;
        }
        
        .filter-dropdown-wide {
            min-width: 280px;
        }
        
        /* 表頭可點擊樣式 */
        .th-clickable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .th-clickable:hover {
            background-color: #1e3a8a;
        }
    </style>
</head>
<body class="h-full bg-gray-50">
    <div id="app" v-cloak>
        <!-- Header -->
        <div class="bg-blue-700 text-white shadow-lg flex-shrink-0">
            <div class="px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i data-lucide="clipboard-check" class="w-8 h-8 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        <div>
                            <h1 class="text-2xl font-bold">長官審核系統</h1>
                            <p class="text-blue-200 text-sm">請購申請審核管理（需主任 & 叔叔雙重簽核）</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <!-- 清除篩選按鈕 -->
                        <button 
                            v-if="hasAnyFilter"
                            @click="resetAllFilters"
                            class="px-3 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition text-sm flex items-center">
                            <i data-lucide="filter-x" class="w-4 h-4 mr-1"></i>
                            清除篩選
                        </button>
                        <div class="text-right">
                            <div class="text-sm">待審核件數</div>
                            <div class="text-3xl font-bold">{{ pendingItems.length }}</div>
                            <div class="text-xs text-blue-200 mt-1">未開單且待確認</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Filter Tabs -->
            <div class="bg-white shadow-md flex-shrink-0">
                <div class="flex border-b">
                    <button 
                        @click="currentTab = 'pending'"
                        :class="currentTab === 'pending' ? 'border-b-2 border-blue-700 text-blue-700' : 'text-gray-600'"
                        class="px-6 py-3 font-medium hover:text-blue-700 transition flex items-center">
                        待審核 ({{ pendingItems.length }}) <i data-lucide="clock" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                    </button>
                    <button 
                        @click="currentTab = 'approved'"
                        :class="currentTab === 'approved' ? 'border-b-2 border-blue-700 text-blue-700' : 'text-gray-600'"
                        class="px-6 py-3 font-medium hover:text-blue-700 transition flex items-center">
                        已確認 ({{ approvedItems.length }}) <i data-lucide="check-circle" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                    </button>
                    <button 
                        @click="currentTab = 'rejected'"
                        :class="currentTab === 'rejected' ? 'border-b-2 border-blue-700 text-blue-700' : 'text-gray-600'"
                        class="px-6 py-3 font-medium hover:text-blue-700 transition flex items-center">
                        已退回 ({{ rejectedItems.length }}) <i data-lucide="x-circle" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                    </button>
                    <button 
                        @click="currentTab = 'all'"
                        :class="currentTab === 'all' ? 'border-b-2 border-blue-700 text-blue-700' : 'text-gray-600'"
                        class="px-6 py-3 font-medium hover:text-blue-700 transition flex items-center">
                        全部 ({{ allFilteredItems.length }}) <i data-lucide="list" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                    </button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="bg-white border-b shadow-sm px-4 py-3 flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <button 
                            @click="selectAll"
                            v-if="currentTab === 'pending'"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm flex items-center">
                            全選 <i data-lucide="check-square" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                        <button 
                            @click="clearSelection"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm">
                            取消全選 <i data-lucide="square" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                        <span class="text-gray-600 text-sm">
                            已選擇: <strong class="text-blue-700">{{ selectedIds.length }}</strong> 筆
                        </span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button 
                            @click="approveSelected"
                            :disabled="selectedIds.length === 0"
                            :class="selectedIds.length === 0 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-600'"
                            class="px-6 py-2 bg-green-500 text-white rounded-lg transition text-sm flex items-center">
                            批次確認 ({{ selectedIds.length }}) <i data-lucide="check" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                        <button 
                            @click="rejectSelected"
                            :disabled="selectedIds.length === 0"
                            :class="selectedIds.length === 0 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-red-600'"
                            class="px-6 py-2 bg-red-500 text-white rounded-lg transition text-sm flex items-center">
                            批次退回 ({{ selectedIds.length }}) <i data-lucide="x" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                        <button 
                            @click="loadData"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm flex items-center">
                            重新整理 <i data-lucide="refresh-cw" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                        <button 
                            @click="goBackToPurchaseHome"
                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition text-sm flex items-center">
                            返回請購首頁 <i data-lucide="home" class="w-4 h-4 ml-2" style="display: inline-block; flex-shrink: 0;"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="table-wrapper">
                <div class="bg-white rounded-lg shadow-md overflow-hidden h-full flex flex-col">
                    <div class="table-container">
                        <table class="w-full" style="table-layout: fixed;">
                            <thead class="sticky-header">
                                <tr>
                                    <th v-if="currentTab === 'pending'" class="px-3 py-3 text-center" style="width: 3%;">
                                        <input type="checkbox" @change="toggleSelectAll" :checked="isAllSelected" class="w-4 h-4">
                                    </th>
                                    <th class="px-2 py-3 text-center" style="width: 3%;">#</th>
                                    <th class="px-3 py-3 text-center" style="width: 6%;">總體狀態</th>
                                    <th class="px-3 py-3 text-center" style="width: 5%;">WBS</th>
                                    
                                    <!-- 請購順序（可篩選）-->
                                    <th class="px-3 py-3 text-center th-clickable filter-dropdown-wrapper" 
                                        style="width: 5%;"
                                        :class="{ 'filter-active': isOrdersFiltered }">
                                        <div @click.stop="toggleDropdown('showOrderFilter')" class="flex items-center justify-center gap-1">
                                            <span>請購<br>順序</span>
                                            <span class="text-xs" :class="{ 'rotate-180': showOrderFilter }">▼</span>
                                        </div>
                                        <!-- 下拉篩選 -->
                                        <transition name="fade">
                                            <div v-if="showOrderFilter" @click.stop class="filter-dropdown text-left text-gray-700 font-normal">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="text-sm font-medium">篩選</span>
                                                </div>
                                                <hr class="mb-2">
                                                <div class="max-h-52 overflow-y-auto space-y-1">
                                                    <label v-for="order in uniqueOrders" :key="order" 
                                                           class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded">
                                                        <input type="checkbox" :value="order" v-model="checkedOrders" class="rounded">
                                                        <span class="text-sm">{{ order }}</span>
                                                    </label>
                                                </div>
                                                <div class="pt-2 text-right border-t mt-2">
                                                    <button @click="clearOrderFilter" class="text-xs text-gray-500 hover:text-red-500">清除篩選</button>
                                                </div>
                                            </div>
                                        </transition>
                                    </th>
                                    
                                    <!-- 需求者（可篩選）-->
                                    <th class="px-3 py-3 text-left th-clickable filter-dropdown-wrapper" 
                                        style="width: 6%;"
                                        :class="{ 'filter-active': isPeopleFiltered }">
                                        <div @click.stop="toggleDropdown('showPersonFilter')" class="flex items-center gap-1">
                                            <span>需求者</span>
                                            <span class="text-xs" :class="{ 'rotate-180': showPersonFilter }">▼</span>
                                        </div>
                                        <!-- 下拉篩選 -->
                                        <transition name="fade">
                                            <div v-if="showPersonFilter" @click.stop class="filter-dropdown text-left text-gray-700 font-normal">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="text-sm font-medium">篩選</span>
                                                </div>
                                                <hr class="mb-2">
                                                <div class="max-h-52 overflow-y-auto space-y-1">
                                                    <label v-for="person in uniquePeople" :key="person" 
                                                           class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded">
                                                        <input type="checkbox" :value="person" v-model="checkedPeople" class="rounded">
                                                        <span class="text-sm">{{ person }}</span>
                                                    </label>
                                                </div>
                                                <div class="pt-2 text-right border-t mt-2">
                                                    <button @click="clearPersonFilter" class="text-xs text-gray-500 hover:text-red-500">清除篩選</button>
                                                </div>
                                            </div>
                                        </transition>
                                    </th>
                                    
                                    <!-- 請購項目（可篩選 + 模糊搜尋）-->
                                    <th class="px-3 py-3 text-left th-clickable filter-dropdown-wrapper" 
                                        style="width: 10%;"
                                        :class="{ 'filter-active': isItemsFiltered }">
                                        <div @click.stop="toggleDropdown('showItemFilter')" class="flex items-center gap-1">
                                            <span>請購項目</span>
                                            <span class="text-xs" :class="{ 'rotate-180': showItemFilter }">▼</span>
                                        </div>
                                        <!-- 下拉篩選 -->
                                        <transition name="fade">
                                            <div v-if="showItemFilter" @click.stop class="filter-dropdown filter-dropdown-wide text-left text-gray-700 font-normal">
                                                <input v-model="itemSearchText" placeholder="模糊搜尋..." 
                                                       class="w-full border border-gray-300 px-2 py-1 text-sm rounded mb-2">
                                                <div class="max-h-52 overflow-y-auto space-y-1">
                                                    <label v-for="item in uniqueItems" :key="item" 
                                                           class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded">
                                                        <input type="checkbox" :value="item" v-model="checkedItems" class="rounded">
                                                        <span class="text-sm">{{ item || '(空白)' }}</span>
                                                    </label>
                                                </div>
                                                <div class="pt-2 text-right border-t mt-2">
                                                    <button @click="clearItemFilter" class="text-xs text-gray-500 hover:text-red-500">清除篩選</button>
                                                </div>
                                            </div>
                                        </transition>
                                    </th>
                                    
                                    <!-- 需求原因（可篩選 + 模糊搜尋）-->
                                    <th class="px-3 py-3 text-left th-clickable filter-dropdown-wrapper" 
                                        style="width: 10%;"
                                        :class="{ 'filter-active': isReasonsFiltered }">
                                        <div @click.stop="toggleDropdown('showReasonFilter')" class="flex items-center gap-1">
                                            <span>需求原因</span>
                                            <span class="text-xs" :class="{ 'rotate-180': showReasonFilter }">▼</span>
                                        </div>
                                        <!-- 下拉篩選 -->
                                        <transition name="fade">
                                            <div v-if="showReasonFilter" @click.stop class="filter-dropdown filter-dropdown-wide text-left text-gray-700 font-normal">
                                                <input v-model="reasonSearchText" placeholder="模糊搜尋..." 
                                                       class="w-full border border-gray-300 px-2 py-1 text-sm rounded mb-2">
                                                <div class="max-h-52 overflow-y-auto space-y-1">
                                                    <label v-for="reason in uniqueReasons" :key="reason" 
                                                           class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded">
                                                        <input type="checkbox" :value="reason" v-model="checkedReasons" class="rounded">
                                                        <span class="text-sm">{{ reason || '(空白)' }}</span>
                                                    </label>
                                                </div>
                                                <div class="pt-2 text-right border-t mt-2">
                                                    <button @click="clearReasonFilter" class="text-xs text-gray-500 hover:text-red-500">清除篩選</button>
                                                </div>
                                            </div>
                                        </transition>
                                    </th>
                                    
                                    <!-- 總金額（可篩選）-->
                                    <th class="px-3 py-3 text-right th-clickable filter-dropdown-wrapper" 
                                        style="width: 6%;"
                                        :class="{ 'filter-active': isAmountsFiltered }">
                                        <div @click.stop="toggleDropdown('showAmountFilter')" class="flex items-center justify-end gap-1">
                                            <span>總金額</span>
                                            <span class="text-xs" :class="{ 'rotate-180': showAmountFilter }">▼</span>
                                        </div>
                                        <!-- 下拉篩選 -->
                                        <transition name="fade">
                                            <div v-if="showAmountFilter" @click.stop class="filter-dropdown text-left text-gray-700 font-normal" style="right: 0; left: auto;">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="text-sm font-medium">篩選</span>
                                                </div>
                                                <hr class="mb-2">
                                                <div class="max-h-52 overflow-y-auto space-y-1">
                                                    <label v-for="amount in uniqueAmounts" :key="amount" 
                                                           class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded">
                                                        <input type="checkbox" :value="amount" v-model="checkedAmounts" class="rounded">
                                                        <span class="text-sm">{{ formatMoney(amount) }}</span>
                                                    </label>
                                                </div>
                                                <div class="pt-2 text-right border-t mt-2">
                                                    <button @click="clearAmountFilter" class="text-xs text-gray-500 hover:text-red-500">清除篩選</button>
                                                </div>
                                            </div>
                                        </transition>
                                    </th>
                                    
                                    <th class="px-3 py-3 text-center nowrap-cell" style="width: 6%;">需求日</th>
                                    <th class="px-3 py-3 text-left" style="width: 14%;">報告路徑</th>
                                    <th class="px-3 py-3 text-left" style="width: 10%;">備註</th>
                                    <!-- 主任簽核欄位 -->
                                    <th v-if="currentTab === 'pending' || currentTab === 'rejected' || currentTab === 'all'" 
                                        class="px-3 py-3 text-center bg-indigo-700" style="width: 7%;">主任簽核</th>
                                    <!-- 叔叔簽核欄位 -->
                                    <th v-if="currentTab === 'pending' || currentTab === 'rejected' || currentTab === 'all'" 
                                        class="px-3 py-3 text-center bg-purple-700" style="width: 7%;">叔叔簽核</th>
                                    <!-- 已退回的處理欄位 -->
                                    <th v-if="currentTab === 'rejected'" class="px-3 py-3 text-center" style="width: 6%;">處理</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(item, index) in displayItems" 
                                    :key="item.Id"
                                    :class="{
                                        'row-selected': selectedIds.includes(item.Id), 
                                        'hover-row': true,
                                        'bg-green-50': item['ePR No.'] && item['ePR No.'].trim() !== ''
                                    }"
                                    class="border-b">
                                    <td v-if="currentTab === 'pending'" class="px-3 py-2 text-center">
                                        <input 
                                            type="checkbox" 
                                            :value="item.Id"
                                            v-model="selectedIds"
                                            class="w-4 h-4">
                                    </td>
                                    <td class="px-2 py-2 text-center font-medium text-gray-600 text-sm">{{ index + 1 }}</td>
                                    
                                    <!-- 總體狀態 -->
                                    <td class="px-3 py-2 text-center">
                                        <span 
                                            v-if="item['ePR No.'] && item['ePR No.'].trim() !== ''" 
                                            class="status-badge bg-blue-100 text-blue-800"
                                        >
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1 inline-block align-middle"></i>
                                            已開單
                                        </span>
                                        <span 
                                            v-else 
                                            :class="getOverallStatusClass(item)"
                                        >
                                            {{ getOverallStatusText(item) }}
                                        </span>
                                    </td>
                                    
                                    <td class="px-3 py-2 text-center text-sm">{{ item['WBS'] || '-' }}</td>
                                    <td class="px-3 py-2 text-center text-sm">{{ item['請購順序'] || '-' }}</td>
                                    <td class="px-3 py-2 text-left text-sm">{{ item['需求者'] || '-' }}</td>
                                    <td class="px-3 py-2 text-left text-sm full-content">{{ item['請購項目'] || '-' }}</td>
                                    <td class="px-3 py-2 text-left text-sm full-content">{{ item['需求原因'] || '-' }}</td>
                                    <td class="px-3 py-2 text-right text-sm font-medium nowrap-cell">{{ formatMoney(item['總金額']) }}</td>
                                    <td class="px-3 py-2 text-center text-sm nowrap-cell">{{ formatDate(item['需求日']) }}</td>
                                    <td class="px-3 py-2 text-left text-sm full-content">{{ item['報告路徑'] || '-' }}</td>
                                    <td class="px-3 py-2 text-left">
                                        <div class="remark-display break-words" :title="item['備註']">{{ item['備註'] || '-' }}</div>
                                    </td>
                                    
                                    <!-- 主任簽核操作欄 -->
                                    <td v-if="currentTab === 'pending' || currentTab === 'rejected' || currentTab === 'all'" 
                                        class="px-2 py-2 text-center">
                                        <div class="flex flex-col items-center gap-1">
                                            <span :class="getApprovalStatusClass(item['主任簽核'])" class="mini-badge">
                                                {{ getApprovalStatusText(item['主任簽核']) }}
                                            </span>
                                            <div v-if="currentTab === 'pending' && canApprove(item, 'director')" 
                                                 class="flex gap-1 mt-1">
                                                <button 
                                                    @click="approveDirector(item.Id)"
                                                    class="w-6 h-6 flex items-center justify-center bg-green-500 text-white rounded hover:bg-green-600 transition"
                                                    title="主任簽核通過">
                                                    <i data-lucide="check" class="w-3 h-3"></i>
                                                </button>
                                                <button 
                                                    @click="rejectDirector(item.Id)"
                                                    class="w-6 h-6 flex items-center justify-center bg-red-500 text-white rounded hover:bg-red-600 transition"
                                                    title="主任簽核退回">
                                                    <i data-lucide="x" class="w-3 h-3"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- 叔叔簽核操作欄 -->
                                    <td v-if="currentTab === 'pending' || currentTab === 'rejected' || currentTab === 'all'" 
                                        class="px-2 py-2 text-center">
                                        <div class="flex flex-col items-center gap-1">
                                            <span :class="getApprovalStatusClass(item['叔叔簽核'])" class="mini-badge">
                                                {{ getApprovalStatusText(item['叔叔簽核']) }}
                                            </span>
                                            <!-- 等待主任簽核提示 -->
                                            <div v-if="currentTab === 'pending' && isWaitingForDirector(item)" 
                                                 class="text-xs text-orange-500 mt-1">
                                                等待主任
                                            </div>
                                            <!-- 操作按鈕 -->
                                            <div v-if="currentTab === 'pending' && canApprove(item, 'uncle')" 
                                                 class="flex gap-1 mt-1">
                                                <button 
                                                    @click="approveUncle(item.Id)"
                                                    class="w-6 h-6 flex items-center justify-center bg-green-500 text-white rounded hover:bg-green-600 transition"
                                                    title="叔叔簽核通過">
                                                    <i data-lucide="check" class="w-3 h-3"></i>
                                                </button>
                                                <button 
                                                    @click="rejectUncle(item.Id)"
                                                    class="w-6 h-6 flex items-center justify-center bg-red-500 text-white rounded hover:bg-red-600 transition"
                                                    title="叔叔簽核退回">
                                                    <i data-lucide="x" class="w-3 h-3"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- 已退回的處理按鈕 -->
                                    <td v-if="currentTab === 'rejected'" class="px-3 py-2 text-center">
                                        <button 
                                            @click="clearRemarkAndApprove(item.Id)"
                                            class="px-2 py-1 bg-purple-500 text-white text-xs rounded hover:bg-purple-600 transition flex items-center justify-center"
                                            title="清空備註並重新送審">
                                            處理完成 <i data-lucide="rotate-ccw" class="w-3 h-3 ml-1"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr v-if="displayItems.length === 0">
                                    <td :colspan="currentTab === 'approved' ? 12 : (currentTab === 'rejected' ? 16 : 15)"
                                        class="px-4 py-8 text-center text-gray-500">
                                        
                                        <div class="flex flex-col items-center justify-center">
                                            <i data-lucide="inbox" class="w-12 h-12 mb-2 text-gray-400"></i>
                                            <div>目前沒有資料</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div v-if="loading" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 shadow-xl flex items-center space-x-3">
                <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-gray-700">載入中...</span>
            </div>
        </div>
    </div>
    
    <script src="../static/js/func/supervisor_review.js"></script>
</body>
</html>